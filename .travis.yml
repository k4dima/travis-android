sudo: required
language: android
jdk: oraclejdk8
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -rf $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
env:
  global:
  - ANDROID_API=26
  - ANDROID_BUILD_TOOLS=26.0.2
  - ADB_INSTALL_TIMEOUT=5
  - secure: T/Se5X7I0GIFsBYTs5uWOsWWtjr3LJDM91oFszg4nH0Gn+IKfzFQvczhSEIOpyWI9pQpR/ubjJ3Qlm8u6B3tvUsTi+VxDcwr6xe85mr720+7rYiF7CTdsF43woUqgkHMkpmNW/zcbPH3ACfxakQ/sTjEgDLZrogDGznGDT4xdJ3j10bUbZrzS40b2m91/ltFy3fq0AuV6vGrUbEo4O0E0O+pyJ+Aqae7KfaboI07NvPR/TeJt4s+tiJz12tsuvssbUabK03PSWiu038odld57sOnlAGsS4PhdYJyKQm615GWbzd/pe8Der9V3WMFUCylLK8Rzxm7jiDmuT3jc690OkcmCoVUc8/0hHQmh4tqrfKfCi+PqiZI1LgrMp6EtOQBiw+PTkuN6ZS+cQADngv47Mq+FOSO5hgz2D5NUSFEz8oVBRteBuqGJyX2GFJXWoV6fyoBdb5soumKVpgcVTZ2zbLgQ5UUxL8yIet3cA9wVUEWEJfoK1O2NFv18n9G1MlF/HktplHqlKpYyRlN5vo/2pyPO1nOl35xb2UlBPa7pTC4oFRSzSWBGpbDukLRhJeFCMyCKfKtT3cgP0P3lirkQSz1qiHJn+yL5DEl/F6n2EizCIXRgycnthONWNguY09hnTSeTOhUVt75TGapyoFmEc6C081EiD+yLoGPGyJL5cY=
  - secure: doITLOI5s3pUtr68v781c60Ol1lQuzYmrCc1Az++rOnB+GtbbgbLTzKca1xsGdu+weLSFfh1czm4QuCkfxNcFvwDcTCcpU2kGFwpfnY3KCWonodo1KKgdk6glmmVNtqAlAqv7cvSuzh0S9DVEM/jIukrYQfa3bbLM5Qie5193hBytnh50pBR/Vw2y8MGk5u1FbKf2UYJ3Pl4o7VX9PoFM2VznomZu90ffLISyKLzyjU6TApn1e3uiIk85qnnm4Jh3qNArPCNVVqUdXV60EpMtBzBOPJM1JliIkzyIFX6jwNBX7BCjFZsRHcxm3yQ3eQqMXuj8rz0T9bR+tXXy7q/bL6umhwuV0vY5x8gqWmSM0Ux+AWtkKKwEtxqV/4lUyM2c/KvmxwfocD0iEvSkoe9ZqrfU8+ScDVsaUpvqHpupUzTWhJasHeagWuqFry2xufseVTy7J31+ISR2hmk88LSihRVuMyLUJ3Y+ibmoJCe4/gHZj+eKS1aOZ0m6FXCkZjeO5xq1Hf40Q/cSFDC/NgkiqrTfiIcLcXfedulJWgTda49KDB3BxaGJTwO4p/x2DxbtMeq8cTp5Unhz5u817PqoCUYxkppnCWy6ggO6bh1ZYTVNgC/9cIkc6gPBAhpSSGNkefo7C4WWVuhDmGJA+xE4MlYd1uUM3bp/+WDciyPpAw=
  - secure: HF702Knb3F1xjxkEYiwwRTIgMRStoG0KZz+IPKVBOgGlQNvSMgPlNARWTJIbdRAcuVjwQqogFPdIjGpPWZim84eYHuNxNdzB9p3FUA4G1aT5fNyg7IJdHOzMLocXhnbnDevMVdP7PrP0l5fvVvyKeQCxmYenpTJ8x9yiKo5HCeJorl8GfcqJh6AekeQCdjQID8iUdAH27qQRYHBkiZ3G/To7MQytL84zsjki6iynA6To0nv0xg+Csv4eF9+w8szvrH7v4IxXrzjMIZ+cmT/t4/6m9yw4d8GLaFr5k46iNw8rZU0hb0S7JhKWiA6fq3IBYBjAQ6FJdIYIF4pqtduegrwhVy07SGSnzQAWecZW/f4r510hdbqjV5fhXasmf+rYK1K9kcgIOWXJnihrmGqDI0lKaR9DGweXT68tkxSiExQlods5KXCmLf/8XX2myOgLrg8GE5LZTGnebAp8iZbjaZqESUBTVhgUKQuTe/D/H6g+YXS4jAjOMhFy2RG2WWP6JCV/Eaj0QbdnAVPm2YVXyGm0jpoV/f9Q3MI1dCMbE4KiHLLHrCCH+RJ7/tPKTjfKddaCHXnUtLoPx5WTRY5yTrj/nn7jMr6lWh9P/viMeW1pR2aZlAcH9Mc4Rlq8GUY6x7uConjTF44zd7X8Qj4m5E1wYoubJAfjld1/a37st6g=
android:
  components:
  - tools
  - tools
  - platform-tools
  - android-${ANDROID_API}
  - build-tools-${ANDROID_BUILD_TOOLS}
  - extra
script:
- "./gradlew clean test build"
before_deploy:
- cd app/build/outputs/apk/release
- jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore ${TRAVIS_BUILD_DIR}/keystore.jks
  -storepass $storepass -keypass $keypass app-release-unsigned.apk key0
- jarsigner -verify app-release-unsigned.apk
- "${ANDROID_HOME}/build-tools/${ANDROID_BUILD_TOOLS}/zipalign -v 4 app-release-unsigned.apk
  TravisAndroid.apk"
- cd -
- scripts/tag.sh
deploy:
  provider: releases
  on:
    branch: master
  api_key:
    secure: Lb4MkrifEzkRd89Okzr82SPh44xpojz7ZeE43yt/wOJX7ZD0e0wyZ6u5M2pDaMjtoqU2YGMd2ppqyMQtqNEkQA2L1NQEd0G9Ch5n0nt5Dmw2AioOWZbfHW1uC/mX/kwDZrDWwxnq/y2aUlTA52ZSF5z8nfKGWJTu5/SJX0H/d0nmbgOE3HfHx7FrWJ+IkRtTXzuXKAbc9upNp5aTiQ2QU9xoH2H3JZZFbSqhT3v4sMRTVl9iJgY17AM9XFImih5wT3h5p8F1qE5sGZWL5s5CJNoE3HedcJI4h8Y9G+GKnJB7DDRM3CKwQg/d/EZiIVGqLfIValgjVEtb/s5/D3TIbBnGZIsitQMVLia+i7VNyYgURC6/rl9vvaOh1h2O8VGhe3avLbv1NiukHApajTvVWpVxrs7xigMmMADpX/tm77OKXg1KvHKse0hbTPxwACLTYKfWz9Ngr1xONd9GqHegrhR9OCPcKURvwB9s1YDQBmfkkGTQIEsGty9KTfnHsuy0roCv+VY3tygmcUVd3uBsho5Jr2GbUiE4HrVWfgxV0lQZYyLhRJ1OOcYHakIor0VhJqP2A1BWRKgN2RLzb3RcncT3jo3zP7VXto+4oVC/6rhKlFAOBNlIIiaA7iGdHgYB4Yirv4firYUdRT0snPSR8Y9Qp5B7S2TPbhs/AMnHEcc=
  file: app/build/outputs/apk/release/TravisAndroid.apk
  overwrite: true
  skip_cleanup: true
before_install:
- openssl aes-256-cbc -K $encrypted_53fbf29b3729_key -iv $encrypted_53fbf29b3729_iv
  -in keystore.jks.enc -out keystore.jks -d
