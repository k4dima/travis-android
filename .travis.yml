sudo: required
language: android
jdk: oraclejdk8
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -rf $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
env:
  global:
  - ANDROID_API=26
  - ANDROID_BUILD_TOOLS=26.0.2
  - ADB_INSTALL_TIMEOUT=5
  - secure: Lez2MY0tdH2lNbUA8GXVroRVoTQ3GiO0UdHQgzqqX87asYf/wT+DO/4zQ3lX9i33rdgo4H5wECkFTHOpCDPSd/2xoBqmiysolGPGreJRALsqD4FnzxaL7eKMJKMIMyKxOkMSqWBdLYc2/deTOepoXkNit+c9Xu3lbKqXyb+bYne6y3NhnJa8rEGGMjg1CaALcolqM/0v5t9B+rNR51KtorYwStcv3sWDNIuEVc3nOjk9bDtg88UjK395ZGoUA8s8QCHzeo1yzxMyUGwHOghWppB7fPYy2qJmU5bCwED/+OfcKsuKF6aKWj7/a1r6LFWXT2UE5EJJufBVDnB8uEb9Fru0DBC1MTB2Ma/el/EQnaNuVv1PkrmIm113k167eXGPN+RIdcFwUfcPC6njdFvCeImpY+JSeygYv7hoVnEMbaZomimA5v/GiRWRz5obbdN3mAK1iJIeFLm4eIaPda4Lf8Ggu84J9pFUk1/YuALJjXy9ceZlUiHpbvLXdKslDKsIPyZs8wL9nyro+DPV9534/agsuTWqCpSstXJgIMD24av2RwMi40CaXrYBMNcYD1NB83jlADBk8dUIYMt9cvbh5s+LhPgZi0XZVT9iFsT4Nhm1VCTPB78QY88waaabJXnOOzYNzli2fLpo656q258GCs3gH3Npf2wHGr83E0gVpdk=
  - secure: UrdRuIm9eLkpG0m+hML0EEWToiQcRLjyfos/kUHpHBVmo1SpMXF3aAAhLymynQINSmTWdndmpUGX/BoSbauvbYW2kZCuAyDZT2gxwfGhiFN0M/XYqywevaGN2ve6DuZSJeT9H3DL6TL0Pl66GXw4KPdECOnOoK2nYcyVaff08wZl2rUKbuz9TSPZ01XrCNMNWyNOKJ2R0ZqQa2BvXX1+fgGKxDhMV7ux/qC2YEqD8oeHwlcPnUMMcMb5/DmmWjR9UFvjL0ZuqWLz55z1Lxiji6baD1npHf6rnce2U69hgkreOBRdEPmrrUroNQpnSn5/n18W0wZAhZBconMwqr4JftB96rJ8gYa7KteK9g7FPuppeTIRQEwg5CI3nbiT2+kMvMTaRELqZAmqmsPU7G4JWYGG/NHfIGw/GMoFwoRQhRURSkBQaU0pa8giNTSt3//KihtPR+z7nofxjlTYHpFAtkGRytMk1kpE6kq3lsgbhBf2+Yr03ZYkTkNKZHkpym0L79KLkc6eOFlgoqer7Ll9dYz0g4YodUySi+KjPzV/oGIWE+zGQ5ccoktNq5WQQZyARA05nOxo0z7wEtm7cofSzS1f60H16750qtRPIjPeivpxeTIIG2W5I3PaVogIcaMmooPmZfikT0o6fXooqH+7P21cUTP4USJalIA8rPJawAk=
  - secure: HHQ113Pi7IJtxder+YbQf+PjtI2GOyxMtLPp4m4/sK5Gu5fhg/ZgcxkuNxYIPmOWVQxOjRqj/0RcGGXNIGtX7TVqOir4XAsiwn4qL6FIpjW/r8GSjC3XWnj4v0NgfBA0DiINcAGB02M5PLX9gRlKIgshYQxAoo8rvAwmZpLjFUkx7FUG1IFZxrgkCmeuTAsjtbFW26C5doqvGwvss5C5g8gsVdJwhRRcW8nQd9VvSbJJtJJigw8YZO6iLc8myf7Z2Nr/6ySIkXTYx7ZdN/JtPzI4ujj4FjqJn7pfX/8UHt2lBoAQWTLbHe7qrdGy0bqyvAeEw7T7eZIXxuEd/ofFydUqoTcno6cQDgMw1OJV286eYNqVZzkrIj7lRh3q0LmmViShyARHnoPbfWiSf0WvMFEjhP0AB+a0G1LbobNW7YLIgWwywB0Yf4j1VKv400zvCeu7RT5pmxLFQ0wZPXAoxuHM0AO9GmuRLYBoTxkko9mfQIniBQwkU2GcnU84vuyQdje8twQoXgaMZJx9RuGpLGFek/gcDaBMv+8CHzdelShqOCMJrzVtKqm6jVI1R/owB9QIIJFQ+19lmQVqPOhIcD+TsbOuK2kQ4KhbVsbjUTWpf9pmDeDMStwfnSd9tsrQ26+NEd1T93z1aI/iBO1lUhICLFm6QG83MbBvfk933K4=
android:
  components:
  - tools
  - tools
  - platform-tools
  - android-${ANDROID_API}
  - build-tools-${ANDROID_BUILD_TOOLS}
  - extra
script:
  - "./gradlew clean test build"
before_deploy:
  - openssl aes-256-cbc -K $encrypted_53fbf29b3729_key -iv $encrypted_53fbf29b3729_iv -in keystore.jks.enc -out keystore.jks -d
  - cd app/build/outputs/apk/release
  - jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore ${TRAVIS_BUILD_DIR}/keystore.jks -storepass $storepass -keypass $keypass app-release-unsigned.apk key0
  - jarsigner -verify app-release-unsigned.apk
  - "${ANDROID_HOME}/build-tools/${ANDROID_BUILD_TOOLS}/zipalign -v 4 app-release-unsigned.apk TravisAndroid.apk"
  - cd -
  - scripts/tag.sh
deploy:
  provider: releases
  on:
    branch: master
  api_key:
    secure: ptnNHl48bo/+i6WeymXskt0GamJBMpT6ghP5Wp4pQ0HAyOR2GUh5T/EqTE7I+SXLGs7iX0eUG65umRbdtWA0FrgrD073wj1zJ25WIV86V8Et+806nRhlfpH1e8mOCIAmpqiKZ7l9Jyd2HiGQ8KrDrX7pGg2uiCtwh7+6j0HMD9nF2U0p11YJrJnb7RvwcyuCZiwRgzNARKi/kCBPsaTh6AVR4FvMPvpP9THkCBQWkaG/C7t3Tgzj+oJJgonfBvftn3h/1t80IcNBVHEysvJpqZtY/mPrsnHPIN/od6bqRtRafIT4JQ2zOxQ7H9qdjiHWRwbDEITv1BoyYCKJxSo2BT684hV8tHqoqjJnDkRHD8Zfx4sQICmWcJ6zQ+iFhpNVSVmi09rx5UNDi8QXfhbIATrVvGjRjLzFAl1IumVp0mKAiTHTlg+k/aeIR3LqKRnoSx8+lTvzvcucyWh3hqtTabJduGErMbl0QdZR/MIYT5ELG8EFOw0OrCuEZP9QmLB5UEBgs808get0q58B7+MRX8cWV5l6dTCvqPTEX3hcmtOc4qtR2QCNi9x/XnY1T+u0bQWKKpWbZsVDPXZ6PStXTWsSmz5CL0gQI2EAhtDd6jaQJq+UpLCt5YaJ2VGY8ogAWeYt5fUqGd4lsLHUoS3405ecG9ou5InOvxuMOUcYJaI=
  file: app/build/outputs/apk/release/TravisAndroid.apk
  overwrite: true
  skip_cleanup: true